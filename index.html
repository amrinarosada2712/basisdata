<!doctype html>
<html lang="id">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kuis Interaktif Basis Data ‚Äî Versi Baru (Soal Ditambah)</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    /* ===== Tema: Biru ‚Ä¢ Putih ‚Ä¢ Abu ===== */
    :root {
      --bg: #ffffff;
      --panel: #f1f5f9;
      --ink: #0f172a;
      --muted: #64748b;
      --primary: #0d6efd;
      --border: #e2e8f0;
      --ok: #22c55e;
      --bad: #ef4444;
    }

    body {
      background: var(--bg);
      color: var(--ink);
    }

    .app-shell {
      max-width: 1100px;
    }

    .card {
      border: 1px solid var(--border);
      border-radius: 1rem;
      background: #fff;
      box-shadow: 0 10px 30px rgba(2, 6, 23, .06);
    }

    .code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: .75rem;
      padding: .75rem 1rem;
    }

    /* Progress biru */
    .progress {
      background: #e9eef6;
      border-radius: .75rem;
      overflow: hidden;
      height: 32px;
    }

    .progress-bar {
      background: var(--primary);
    }

    /* Zona drag&drop */
    .drag-item {
      user-select: none;
    }

    .dropzone {
      min-height: 48px;
      border: 2px dashed #94a3b8;
      border-radius: .75rem;
      background: var(--panel);
      padding: .25rem .5rem;
    }

    .dropzone.filled {
      border-style: solid;
    }

    .is-correct {
      border: 2px solid var(--ok) !important;
      background: #ecfdf5 !important;
    }

    .is-wrong {
      border: 2px solid var(--bad) !important;
      background: #fef2f2 !important;
    }

    /* Tabel terang */
    .table-dark {
      --bs-table-color: var(--ink);
      --bs-table-bg: #fff;
      --bs-table-border-color: var(--border);
      --bs-table-striped-bg: #f8fafc;
      --bs-table-striped-color: var(--ink);
      --bs-table-hover-bg: #eef2f7;
      --bs-table-hover-color: var(--ink);
      color: var(--bs-table-color);
      border-color: var(--bs-table-border-color);
    }

    /* Tombol outline-info ‚Üí biru */
    .btn-outline-info {
      --bs-btn-color: var(--primary);
      --bs-btn-border-color: var(--primary);
      --bs-btn-hover-bg: var(--primary);
      --bs-btn-hover-border-color: var(--primary);
      --bs-btn-active-bg: var(--primary);
      --bs-btn-active-border-color: var(--primary);
      --bs-btn-hover-color: #fff;
      --bs-btn-active-color: #fff;
    }

    .footer-muted {
      color: var(--muted);
    }
  </style>
</head>

<body>
  <div class="container py-5 app-shell">
    <header class="text-center mb-4">
      <h1 class="fw-bold">Kuis Interaktif Basis Data</h1>
      <p class="lead mb-1">Cek otomatis ‚Ä¢ Progres ‚Ä¢ Skor ‚Ä¢ <strong>Unduh hasil</strong></p>
      <div class="small footer-muted">Jawab semua, lalu klik <span class="fw-semibold">Periksa Jawaban</span>. Gunakan
        <span class="fw-semibold">Reset</span> untuk mengulang.</div>
    </header>

    <!-- ===== Kontrol global ===== -->
    <div class="d-flex flex-column gap-3 align-items-center mb-4">
      <div class="row g-2 w-100" style="max-width:900px;">
        <div class="col-md-5">
          <input id="studentName" class="form-control" placeholder="Nama peserta (opsional)">
        </div>
        <div class="col-md-7">
          <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100">
            <div id="progressBar" class="progress-bar fw-semibold" style="width:0%">0%</div>
          </div>
          <div id="progressText" class="small text-center mt-1 text-secondary">0/0 soal terjawab ‚Ä¢ 0% selesai</div>
        </div>
      </div>
      <div class="d-flex gap-2 justify-content-center">
        <button id="checkAll" class="btn btn-success px-4"><i class="bi bi-check2-square"></i> Periksa Jawaban</button>
        <button id="resetAll" class="btn btn-outline-secondary px-4"><i class="bi bi-arrow-counterclockwise"></i>
          Reset</button>
        <button id="downloadReport" class="btn btn-primary px-4"><i class="bi bi-download"></i> Unduh Hasil</button>
        <span id="scoreBadge" class="badge rounded-pill text-bg-info align-self-center">Skor: 0</span>
      </div>
    </div>

    <!-- ===== Bagian 1: Pilihan Ganda ===== -->
    <section class="card mb-4">
      <div class="card-body p-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 class="h5 m-0">Bagian 1 ‚Äî Pilihan Ganda</h2>
          <span class="badge bg-primary">1</span>
        </div>

        <!-- Q1 -->
        <div class="mb-3" data-question="mcq" data-points="10" data-answer="b">
          <p class="mb-2 fw-semibold">1) Fungsi utama DBMS adalah‚Ä¶</p>
          <div class="row row-cols-1 row-cols-md-2 g-2">
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                <label class="form-check-label" for="q1a">Menghapus semua data yang rusak</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                <label class="form-check-label" for="q1b">Mengelola, menyimpan, dan mengakses data secara
                  efisien</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                <label class="form-check-label" for="q1c">Membuat file dokumen</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                <label class="form-check-label" for="q1d">Mengatur sistem operasi</label>
              </div>
            </div>
          </div>
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- Q2 -->
        <div class="mb-3" data-question="mcq" data-points="10" data-answer="b">
          <p class="mb-2 fw-semibold">2) SQL yang benar untuk menampilkan kolom <code>nama</code> dari tabel
            <code>mahasiswa</code> adalah‚Ä¶</p>
          <div class="row row-cols-1 row-cols-md-2 g-2">
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                <label class="form-check-label" for="q2a"><code>SHOW nama FROM mahasiswa;</code></label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                <label class="form-check-label" for="q2b"><code>SELECT nama FROM mahasiswa;</code></label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                <label class="form-check-label" for="q2c"><code>DISPLAY nama FROM mahasiswa;</code></label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                <label class="form-check-label" for="q2d"><code>GET nama FROM mahasiswa;</code></label>
              </div>
            </div>
          </div>
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- Q3 -->
        <div class="mb-3" data-question="mcq" data-points="10" data-answer="a">
          <p class="mb-2 fw-semibold">3) <code>INNER JOIN</code> akan‚Ä¶</p>
          <div class="row row-cols-1 row-cols-md-2 g-2">
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                <label class="form-check-label" for="q3a">Mengembalikan baris yang cocok di kedua tabel</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                <label class="form-check-label" for="q3b">Mengembalikan semua baris dari tabel kiri</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                <label class="form-check-label" for="q3c">Menghapus baris yang tidak cocok</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                <label class="form-check-label" for="q3d">Menambah kolom baru tanpa kecocokan</label>
              </div>
            </div>
          </div>
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- Q4 (baru) -->
        <div class="mb-3" data-question="mcq" data-points="10" data-answer="c">
          <p class="mb-2 fw-semibold">4) Tujuan utama penggunaan <em>index</em> pada kolom adalah‚Ä¶</p>
          <div class="row row-cols-1 row-cols-md-2 g-2">
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                <label class="form-check-label" for="q4a">Menghemat ruang penyimpanan</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                <label class="form-check-label" for="q4b">Mempercepat proses <code>INSERT</code></label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                <label class="form-check-label" for="q4c">Mempercepat proses pencarian (<code>SELECT</code>)</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                <label class="form-check-label" for="q4d">Menjaga referential integrity</label>
              </div>
            </div>
          </div>
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- Q5 (baru) -->
        <div class="mb-3" data-question="mcq" data-points="10" data-answer="d">
          <p class="mb-2 fw-semibold">5) Pada konsep ACID, huruf <strong>I</strong> merujuk pada‚Ä¶</p>
          <div class="row row-cols-1 row-cols-md-2 g-2">
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                <label class="form-check-label" for="q5a">Atomicity</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                <label class="form-check-label" for="q5b">Consistency</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                <label class="form-check-label" for="q5c">Availability</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                <label class="form-check-label" for="q5d">Isolation</label>
              </div>
            </div>
          </div>
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- Q6 (baru) -->
        <div class="mb-1" data-question="mcq" data-points="10" data-answer="a">
          <p class="mb-2 fw-semibold">6) Manakah yang <em>paling tepat</em> mendeskripsikan <strong>Normal Form 3
              (3NF)</strong>?</p>
          <div class="row row-cols-1 row-cols-md-2 g-2">
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q6" id="q6a" value="a">
                <label class="form-check-label" for="q6a">Tidak ada ketergantungan transitif pada kunci</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q6" id="q6b" value="b">
                <label class="form-check-label" for="q6b">Semua kolom adalah atomic</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q6" id="q6c" value="c">
                <label class="form-check-label" for="q6c">Tidak ada nilai NULL</label>
              </div>
            </div>
            <div class="col">
              <div class="form-check bg-white p-2 rounded border">
                <input class="form-check-input" type="radio" name="q6" id="q6d" value="d">
                <label class="form-check-label" for="q6d">Semua kolom harus berindeks</label>
              </div>
            </div>
          </div>
          <div class="mt-2 small" data-feedback></div>
        </div>
      </div>
    </section>

    <!-- ===== Bagian 2: Isian Otomatis ===== -->
    <section class="card mb-4">
      <div class="card-body p-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 class="h5 m-0">Bagian 2 ‚Äî Isian Otomatis</h2>
          <span class="badge bg-primary">2</span>
        </div>

        <!-- Q7 -->
        <div class="mb-3" data-question="input" data-points="10"
          data-keywords='[{"type":"regex","pattern":"^\\s*INSERT\\s+INTO\\s+produk\\s*\\(\\s*id\\s*,\\s*nama\\s*,\\s*harga\\s*\\)\\s*VALUES\\s*\\(.*\\)\\s*;?\\s*$","flags":"i"}]'>
          <p class="fw-semibold mb-2">1) SQL untuk menambahkan data ke <code>produk(id, nama, harga)</code>.</p>
          <textarea class="form-control" rows="3"
            placeholder="INSERT INTO produk (id, nama, harga) VALUES (1, 'Pulpen', 2500);"></textarea>
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- Q8 -->
        <div class="mb-3" data-question="input" data-points="10"
          data-keywords='[{"type":"includes","any":["redundansi","konsistensi","efisiensi","integritas"]}]'>
          <p class="fw-semibold mb-2">2) Sebutkan dua keuntungan normalisasi basis data.</p>
          <input class="form-control" placeholder="Contoh: mengurangi redundansi, meningkatkan konsistensi">
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- Q9 (baru) -->
        <div class="mb-1" data-question="input" data-points="10"
          data-keywords='[{"type":"regex","pattern":"^\\s*CREATE\\s+TABLE\\s+mahasiswa\\s*\\(.*nim.*nama.*jurusan.*\\)\\s*;?\\s*$","flags":"i"}]'>
          <p class="fw-semibold mb-2">3) DDL untuk membuat tabel <code>mahasiswa(nim, nama, jurusan)</code>.</p>
          <textarea class="form-control" rows="3"
            placeholder="CREATE TABLE mahasiswa (nim VARCHAR(10) PRIMARY KEY, nama VARCHAR(100), jurusan VARCHAR(50));"></textarea>
          <div class="mt-2 small" data-feedback></div>
        </div>
      </div>
    </section>

    <!-- ===== Bagian 3: Drag & Drop Matching ===== -->
    <section class="card mb-4">
      <div class="card-body p-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 class="h5 m-0">Bagian 3 ‚Äî Cocokkan Pasangan</h2>
          <span class="badge bg-primary">3</span>
        </div>

        <!-- Matching A -->
        <div class="row g-3 mb-4" data-question="match" data-points="15"
          data-map='{"Primary Key":"Kolom unik dan tidak boleh NULL","Foreign Key":"Menghubungkan dua tabel","Query":"Perintah untuk mengambil atau memanipulasi data"}'>

          <!-- bank -->
          <div class="col-md-5">
            <div class="p-3 rounded-3 border">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div class="fw-semibold">Bank Istilah (A)</div>
                <button class="btn btn-sm btn-outline-secondary reset-match">Reset</button>
              </div>
              <div class="d-grid gap-2">
                <button class="btn btn-outline-info drag-item" draggable="true" data-item="Primary Key">Primary
                  Key</button>
                <button class="btn btn-outline-info drag-item" draggable="true" data-item="Foreign Key">Foreign
                  Key</button>
                <button class="btn btn-outline-info drag-item" draggable="true" data-item="Query">Query</button>
              </div>
              <div class="small text-secondary mt-2">Tarik istilah ke kotak penjelasan yang sesuai.</div>
            </div>
          </div>

          <!-- target -->
          <div class="col-md-7">
            <div class="p-3 rounded-3 border">
              <div class="fw-semibold mb-2">Cocokkan ke Penjelasan</div>
              <div class="vstack gap-3">
                <div>
                  <div class="small text-secondary mb-1">Kolom unik dan tidak boleh NULL</div>
                  <div class="dropzone dropzone-match p-2 rounded" data-target="Kolom unik dan tidak boleh NULL"></div>
                </div>
                <div>
                  <div class="small text-secondary mb-1">Menghubungkan dua tabel</div>
                  <div class="dropzone dropzone-match p-2 rounded" data-target="Menghubungkan dua tabel"></div>
                </div>
                <div>
                  <div class="small text-secondary mb-1">Perintah untuk mengambil atau memanipulasi data</div>
                  <div class="dropzone dropzone-match p-2 rounded"
                    data-target="Perintah untuk mengambil atau memanipulasi data"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- Matching B (baru) -->
        <div class="row g-3" data-question="match" data-points="15"
          data-map='{"UNIQUE":"Menjamin nilai kolom tidak duplikat","NOT NULL":"Melarang nilai kosong","CHECK":"Membatasi nilai berdasarkan ekspresi logis"}'>

          <!-- bank -->
          <div class="col-md-5">
            <div class="p-3 rounded-3 border">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div class="fw-semibold">Bank Istilah (B)</div>
                <button class="btn btn-sm btn-outline-secondary reset-match">Reset</button>
              </div>
              <div class="d-grid gap-2">
                <button class="btn btn-outline-info drag-item" draggable="true" data-item="UNIQUE">UNIQUE</button>
                <button class="btn btn-outline-info drag-item" draggable="true" data-item="NOT NULL">NOT NULL</button>
                <button class="btn btn-outline-info drag-item" draggable="true" data-item="CHECK">CHECK</button>
              </div>
            </div>
          </div>

          <!-- target -->
          <div class="col-md-7">
            <div class="p-3 rounded-3 border">
              <div class="fw-semibold mb-2">Cocokkan ke Penjelasan</div>
              <div class="vstack gap-3">
                <div>
                  <div class="small text-secondary mb-1">Menjamin nilai kolom tidak duplikat</div>
                  <div class="dropzone dropzone-match p-2 rounded" data-target="Menjamin nilai kolom tidak duplikat">
                  </div>
                </div>
                <div>
                  <div class="small text-secondary mb-1">Melarang nilai kosong</div>
                  <div class="dropzone dropzone-match p-2 rounded" data-target="Melarang nilai kosong"></div>
                </div>
                <div>
                  <div class="small text-secondary mb-1">Membatasi nilai berdasarkan ekspresi logis</div>
                  <div class="dropzone dropzone-match p-2 rounded"
                    data-target="Membatasi nilai berdasarkan ekspresi logis"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-2 small" data-feedback></div>
        </div>
      </div>
    </section>

    <!-- ===== Bagian 4: Kueri SQL & Debug ===== -->
    <section class="card mb-5">
      <div class="card-body p-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 class="h5 m-0">Bagian 4 ‚Äî Kueri SQL</h2>
          <span class="badge bg-primary">4</span>
        </div>

        <div class="alert alert-secondary small">Gunakan tabel <code>barang(id, nama, harga, stok)</code>.</div>
        <div class="table-responsive mb-3">
          <table class="table table-dark table-striped table-bordered align-middle mb-0">
            <thead>
              <tr>
                <th>id</th>
                <th>nama</th>
                <th>harga</th>
                <th>stok</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td>
                <td>Buku</td>
                <td>5000</td>
                <td>20</td>
              </tr>
              <tr>
                <td>2</td>
                <td>Pulpen</td>
                <td>2000</td>
                <td>50</td>
              </tr>
              <tr>
                <td>3</td>
                <td>Penghapus</td>
                <td>1000</td>
                <td>30</td>
              </tr>
              <tr>
                <td>4</td>
                <td>Spidol</td>
                <td>7000</td>
                <td>0</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- SQL-1 -->
        <div class="mb-3" data-question="sql" data-points="10"
          data-answers='["SELECT * FROM barang WHERE harga > 2000;","SELECT * FROM barang WHERE harga>2000;"]'>
          <div class="fw-semibold mb-1">1) Tampilkan semua barang dengan harga di atas 2000.</div>
          <input class="form-control" placeholder="SELECT * FROM barang WHERE harga > 2000;">
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- SQL-2 (baru) -->
        <div class="mb-3" data-question="sql" data-points="10"
          data-answers='["DELETE FROM barang WHERE stok = 0;","DELETE FROM barang WHERE stok=0;"]'>
          <div class="fw-semibold mb-1">2) Hapus semua barang yang <code>stok = 0</code>.</div>
          <input class="form-control" placeholder="DELETE FROM barang WHERE stok = 0;">
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- SQL-3 (baru) -->
        <div class="mb-3" data-question="sql" data-points="10" data-answers='[
               "SELECT nama, COUNT(*) AS jumlah FROM barang GROUP BY nama;",
               "select nama, count(*) as jumlah from barang group by nama;"
             ]'>
          <div class="fw-semibold mb-1">3) Tampilkan <code>nama</code> dan jumlah kemunculannya dari tabel
            <code>barang</code>.</div>
          <input class="form-control" placeholder="SELECT nama, COUNT(*) AS jumlah FROM barang GROUP BY nama;">
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- Debug-1 -->
        <div class="mb-3" data-question="debug" data-points="9"
          data-correct="UPDATE barang SET harga = 2500 WHERE nama = 'Pulpen';">
          <div class="fw-semibold mb-2">4) Perbaiki query salah: <span class="code">UPDATA barang SET harga=2500 WHERE
              nama='Pulpen'</span></div>
          <input class="form-control" placeholder="UPDATE barang SET harga = 2500 WHERE nama = 'Pulpen';">
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- Debug-2 (baru) -->
        <div class="mb-1" data-question="debug" data-points="9"
          data-correct="SELECT nama, harga FROM barang WHERE harga >= 2000;">
          <div class="fw-semibold mb-2">5) Perbaiki query salah: <span class="code">SELECT nama harga FROM barang WHERE
              harga &gt;=;</span></div>
          <input class="form-control" placeholder="SELECT nama, harga FROM barang WHERE harga >= 2000;">
          <div class="mt-2 small" data-feedback></div>
        </div>
      </div>
    </section>

    <!-- ===== Bagian 5: Studi Kasus ===== -->
    <section class="card mb-5">
      <div class="card-body p-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 class="h5 m-0">Bagian 5 ‚Äî Studi Kasus Mini</h2>
          <span class="badge bg-primary">5</span>
        </div>

        <!-- Case-1 -->
        <div class="mb-3" data-question="sql" data-points="12" data-answers='[
               "SELECT * FROM transaksi WHERE total > 100000 AND tanggal >= \"2025-10-01\" AND tanggal < \"2025-11-01\";",
               "SELECT * FROM transaksi WHERE total>100000 AND tanggal>=\"2025-10-01\" AND tanggal<\"2025-11-01\";"
             ]'>
          <div class="fw-semibold mb-1">1) Tampilkan transaksi dengan <code>total &gt; 100000</code> pada
            <strong>Oktober 2025</strong>.</div>
          <input class="form-control"
            placeholder='SELECT * FROM transaksi WHERE total > 100000 AND tanggal >= "2025-10-01" AND tanggal < "2025-11-01";'>
          <div class="mt-2 small" data-feedback></div>
        </div>

        <!-- Case-2 (baru) -->
        <div class="mb-1" data-question="sql" data-points="13" data-answers='[
               "SELECT m.nama, COUNT(t.id) AS jml FROM mahasiswa m LEFT JOIN transaksi t ON t.mhs_id = m.id GROUP BY m.nama;",
               "select m.nama, count(t.id) as jml from mahasiswa m left join transaksi t on t.mhs_id=m.id group by m.nama;"
             ]'>
          <div class="fw-semibold mb-1">2) Tampilkan setiap <code>mahasiswa.nama</code> dan jumlah transaksi yang
            dimilikinya (0 jika tidak ada). Gunakan <code>LEFT JOIN</code>.</div>
          <input class="form-control"
            placeholder="SELECT m.nama, COUNT(t.id) AS jml FROM mahasiswa m LEFT JOIN transaksi t ON t.mhs_id = m.id GROUP BY m.nama;">
          <div class="mt-2 small" data-feedback></div>
        </div>
      </div>
    </section>

    <footer class="text-center mb-4">
      <div class="footer-muted">¬© 2025 ‚Äî Kuis Interaktif Basis Data (Biru ‚Ä¢ Putih ‚Ä¢ Abu) ‚Ä¢ Paket soal diperluas</div>
    </footer>
  </div>

  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      /* ===== State & Utils ===== */
      const blocks = () => Array.from(document.querySelectorAll('[data-question]'));
      const MAX_POINTS = blocks().reduce((sum, b) => sum + (+b.dataset.points || 0), 0);
      let lastScore = 0, lastAnswered = 0;

      const normSQL = s => (s || '')
        .replace(/\s+/g, ' ')
        .replace(/\s*;\s*$/, ';')
        .trim()
        .toLowerCase();

      const toast = (msg, type = 'info') => {
        const el = document.createElement('div');
        el.className = `alert alert-${type} position-fixed top-0 start-50 translate-middle-x mt-3 shadow`;
        el.style.zIndex = 1080;
        el.textContent = msg;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1800);
      };

      /* ===== Checkers ===== */
      function checkMCQ(block) {
        const ans = block.dataset.answer;
        const points = +block.dataset.points || 0;
        const sel = block.querySelector('input[type="radio"]:checked');
        const fb = block.querySelector('[data-feedback]');
        let got = 0;
        if (!sel) { fb.innerHTML = '<span class="text-warning">Belum memilih opsi.</span>'; }
        else if (sel.value === ans) { got = points; fb.innerHTML = '<span class="text-success">üéâ Tepat!</span>'; }
        else { fb.innerHTML = '<span class="text-danger">Kurang tepat. Jawaban benar: <strong>' + ans.toUpperCase() + '</strong></span>'; }
        return got;
      }

      function checkInput(block) {
        const raw = (block.querySelector('textarea, input')?.value || '').trim();
        const rules = JSON.parse(block.dataset.keywords || '[]');
        const fb = block.querySelector('[data-feedback]');
        const points = +block.dataset.points || 0;
        if (!raw) { fb.innerHTML = '<span class="text-warning">Masih kosong.</span>'; return 0; }
        let ok = false;
        for (const r of rules) {
          if (r.type === 'includes') {
            const any = (r.any || []).some(k => raw.toLowerCase().includes(k.toLowerCase()));
            if (any) { ok = true; break; }
          } else if (r.type === 'regex') {
            const re = new RegExp(r.pattern, r.flags || '');
            if (re.test(raw)) { ok = true; break; }
          }
        }
        fb.innerHTML = ok ? '<span class="text-success">‚úîÔ∏è Oke, memuat konsep kunci.</span>'
          : '<span class="text-danger">‚ùå Belum memuat kata kunci yang diminta.</span>';
        return ok ? points : 0;
      }

      function checkSQL(block) {
        const input = block.querySelector('input, textarea').value || '';
        const answers = JSON.parse(block.dataset.answers || '[]');
        const fb = block.querySelector('[data-feedback]');
        const points = +block.dataset.points || 0;
        if (!input.trim()) { fb.innerHTML = '<span class="text-warning">Masih kosong.</span>'; return 0; }
        const ok = answers.some(a => normSQL(a) === normSQL(input));
        fb.innerHTML = ok ? '<span class="text-success">‚úîÔ∏è Benar</span>' : '<span class="text-danger">‚ùå Belum tepat</span>';
        return ok ? points : 0;
      }

      function checkDebug(block) {
        const input = block.querySelector('input').value || '';
        const target = block.dataset.correct || '';
        const fb = block.querySelector('[data-feedback]');
        const points = +block.dataset.points || 0;
        if (!input.trim()) { fb.innerHTML = '<span class="text-warning">Masih kosong.</span>'; return 0; }
        const ok = normSQL(input) === normSQL(target);
        fb.innerHTML = ok ? '<span class="text-success">‚úîÔ∏è Benar</span>' : '<span class="text-danger">‚ùå Belum tepat</span>';
        return ok ? points : 0;
      }

      /* ===== Drag & Drop matching (mendukung banyak blok) ===== */
      function initMatchingFor(container) {
        let dragged = null;
        container.querySelectorAll('.drag-item').forEach(btn => {
          btn.addEventListener('dragstart', () => { dragged = btn; btn.classList.add('btn-info'); });
          btn.addEventListener('dragend', () => { dragged = null; btn.classList.remove('btn-info'); });
        });

        const zones = container.querySelectorAll('.dropzone-match');
        const removeDuplicates = (name) => {
          zones.forEach(z => {
            const placed = z.querySelector('.drag-item');
            if (placed && placed.dataset.item === name) { placed.parentElement?.remove(); }
          });
        };

        zones.forEach(zone => {
          zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('filled'); });
          zone.addEventListener('dragleave', () => zone.classList.remove('filled'));
          zone.addEventListener('drop', e => {
            e.preventDefault(); zone.classList.remove('filled');
            if (!dragged) return;
            const name = dragged.dataset.item;
            removeDuplicates(name);
            [...zone.children].forEach(c => c.remove());
            const clone = dragged.cloneNode(true);
            clone.classList.remove('btn-outline-info'); clone.classList.add('btn-secondary');
            clone.setAttribute('draggable', 'false');

            const wrap = document.createElement('div');
            wrap.className = 'd-inline-flex align-items-center gap-2';
            const close = document.createElement('button');
            close.className = 'btn btn-sm btn-outline-secondary'; close.textContent = '√ó';
            close.addEventListener('click', () => wrap.remove());

            wrap.appendChild(clone); wrap.appendChild(close);
            zone.appendChild(wrap);
          });
        });

        container.querySelector('.reset-match')?.addEventListener('click', () => {
          container.querySelectorAll('.dropzone-match').forEach(z => { z.innerHTML = ''; z.classList.remove('is-correct', 'is-wrong', 'filled'); });
          const fb = container.closest('[data-question="match"]').querySelector('[data-feedback]');
          if (fb) fb.innerHTML = '';
        });
      }

      // inisialisasi semua blok matching
      document.querySelectorAll('[data-question="match"]').forEach(block => {
        initMatchingFor(block);
      });

      function checkMatch(block) {
        const fb = block.querySelector('[data-feedback]');
        const map = JSON.parse(block.dataset.map || '{}');
        const zones = block.querySelectorAll('.dropzone');
        const points = +block.dataset.points || 0;
        let correct = 0, total = Object.keys(map).length;

        zones.forEach(z => {
          const target = z.dataset.target;
          const placed = z.querySelector('.drag-item');
          const name = placed ? placed.dataset.item : null;
          if (name && map[name] === target) { z.classList.add('is-correct'); z.classList.remove('is-wrong'); correct++; }
          else { z.classList.add('is-wrong'); z.classList.remove('is-correct'); }
        });

        const ok = (correct === total);
        fb.innerHTML = ok ? `<span class="text-success">‚úîÔ∏è Semua cocok (${correct}/${total})</span>`
          : `<span class="text-danger">${correct}/${total} benar ‚Äî periksa lagi.</span>`;
        return ok ? points : 0;
      }

      /* ===== Progres & Skor ===== */
      function updateProgress() {
        const total = blocks().length;
        const answered = blocks().reduce((n, b) => {
          const t = b.dataset.question;
          if (t === 'mcq') return n + (b.querySelector('input[type="radio"]:checked') ? 1 : 0);
          if (t === 'input' || t === 'sql' || t === 'debug') return n + ((b.querySelector('textarea, input')?.value.trim() || '').length > 0 ? 1 : 0);
          if (t === 'match') return n + (b.querySelectorAll('.dropzone-match .drag-item').length > 0 ? 1 : 0);
          return n;
        }, 0);
        lastAnswered = answered;
        const pct = total ? Math.round((answered / total) * 100) : 0;
        const bar = document.getElementById('progressBar');
        const txt = document.getElementById('progressText');
        if (bar) { bar.style.width = pct + '%'; bar.textContent = pct + '%'; bar.setAttribute('aria-valuenow', pct); }
        if (txt) { txt.textContent = `${answered}/${total} soal terjawab ‚Ä¢ ${pct}% selesai`; }
      }

      function computeScore() {
        let score = 0;
        const detail = [];
        blocks().forEach((block, i) => {
          const t = block.dataset.question;
          let got = 0;
          if (t === 'mcq') got = checkMCQ(block);
          else if (t === 'input') got = checkInput(block);
          else if (t === 'sql') got = checkSQL(block);
          else if (t === 'debug') got = checkDebug(block);
          else if (t === 'match') got = checkMatch(block);
          score += got;
          detail.push({ no: i + 1, type: t, points: +(block.dataset.points || 0), got });
        });
        lastScore = score;
        document.getElementById('scoreBadge').textContent = `Skor: ${score} / ${MAX_POINTS}`;
        updateProgress();
        toast(`Skor kamu: ${score}/${MAX_POINTS}`, 'success');

        // simpan untuk unduhan
        window.__quizReport = {
          score, max: MAX_POINTS, answered: lastAnswered,
          name: (document.getElementById('studentName')?.value || '').trim(),
          detail
        };
      }

      function resetAll() {
        document.getElementById('scoreBadge').textContent = 'Skor: 0';
        document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
        document.querySelectorAll('textarea, input[type="text"], input.form-control')
          .forEach(i => { if (i.id !== 'studentName') i.value = ''; });
        document.querySelectorAll('[data-feedback]').forEach(f => f.innerHTML = '');
        document.querySelectorAll('.dropzone').forEach(z => { z.innerHTML = ''; z.classList.remove('is-correct', 'is-wrong', 'filled'); });
        lastScore = 0; lastAnswered = 0;
        updateProgress();
        toast('Kuis telah direset', 'info');
      }

      document.getElementById('checkAll').addEventListener('click', computeScore);
      document.getElementById('resetAll').addEventListener('click', resetAll);
      document.addEventListener('input', e => { if (e.target.matches('input, textarea')) updateProgress(); });
      document.addEventListener('change', e => { if (e.target.matches('input[type="radio"]')) updateProgress(); });
      updateProgress();

      /* ===== Unduh Hasil (kompatibel) ===== */
      function saveTextFile(filename, text) {
        // Tambahkan BOM agar aman di Notepad (Windows)
        const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
        const blob = new Blob([bom, text], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.rel = 'noopener';
        a.target = '_self';
        document.body.appendChild(a);
        a.click();
        setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 1000);
      }

      document.getElementById('downloadReport').addEventListener('click', () => {
        // pastikan skor paling baru
        if (!window.__quizReport) computeScore();

        const now = new Date();
        const pad = n => String(n).padStart(2, '0');
        const stamp = `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}_${pad(now.getHours())}-${pad(now.getMinutes())}`;
        const name = (document.getElementById('studentName')?.value || '').trim();
        const safeName = name ? '-' + name.replace(/[^a-z0-9]+/gi, '_') : '';
        const fname = `hasil-kuis${safeName}-${stamp}.txt`;

        const rpt = window.__quizReport || { score: 0, max: 0, answered: 0, name };
        const lines = [
          'Hasil Kuis Interaktif Basis Data',
          `Nama: ${rpt.name || '-'}`,
          `Tanggal: ${now.toISOString()}`,
          `Skor: ${rpt.score} / ${rpt.max}`,
          `Terjawab: ${rpt.answered} soal`,
          '',
          'Rincian:',
          ...(rpt.detail || []).map(d => `- No ${d.no} [${d.type}] : ${d.got}/${d.points}`)
        ].join('\n');

        saveTextFile(fname, lines);
      });
    });
  </script>
</body>

</html>